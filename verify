#!/bin/bash

ok=1
failures=""

run() {
    name=$1
    if [ $# -eq 1 ] ; then
        echo "$name":
        if [ $name = *.java ] ; then
            program=$(basename $name .java)
            javac $name
            java $program > $name.out
            rm $program.class
        else
            ./$1 > $name.out
        fi
    else
        shift
        echo "$name":
        eval "$@" && ./fizzbuzz > $name.out
        rm -f fizzbuzz fizzbuzz.ali fizzbuzz.o
    fi
    if ! cmp -s $name.out expected-output.txt ; then
        ok=0
        failures="$failures $name"
    fi
    rm -f $name.out
}

run fizzbuzz.adb     gnatmake fizzbuzz
run fizzbuzz.bash
run fizzbuzz.c       gcc -std=c99 fizzbuzz.c -o fizzbuzz
run fizzbuzz.cpp     g++ fizzbuzz.cpp -o fizzbuzz
run fizzbuzz.csh
run fizzbuzz.f       gfortran fizzbuzz.f -o fizzbuzz
run fizzbuzz.go      go build -o fizzbuzz fizzbuzz.go
run fizzbuzz.guile
run fizzbuzz.java
run fizzbuzz.js
run fizzbuzz.lua
run fizzbuzz.pas     fpc fizzbuzz.pas
run fizzbuzz.php
run fizzbuzz.pl
run fizzbuzz.pl6
run fizzbuzz.py
run fizzbuzz.rb
run fizzbuzz.sh

if [ $ok -eq 1 ] ; then
    echo OK
else
    echo Failures: $failures
fi
